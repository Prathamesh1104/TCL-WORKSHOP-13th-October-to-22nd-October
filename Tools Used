# File: yosys_synth.tcl
# Purpose: Automate Yosys synthesis for a design

# Variables
set DesignName "my_design"
set OutputDirectory "./results"
set NetlistDirectory "./rtl"
set LateLibraryPath "./lib/tech.lib"

# Generate Yosys script (.ys)
set ys_file "$OutputDirectory/$DesignName.ys"
set fid [open $ys_file w]
puts $fid "read_liberty -lib $LateLibraryPath"

# Read all Verilog files in RTL directory
foreach f [glob -dir $NetlistDirectory *.v] {
    puts $fid "read_verilog $f"
}

# Synthesize top module and write output
puts $fid "synth -top $DesignName"
puts $fid "write_verilog $OutputDirectory/$DesignName.synth.v"
close $fid

# Execute Yosys
if {[catch {exec yosys -s $ys_file} msg]} {
    puts "Error: $msg"
} else {
    puts "Synthesis Successful!"
}

